#!/bin/bash

var="$1"

[ -z "$var" ] && {
    echo "usage: $0 <env var name>"
    exit 1
}

(
    set -e
    set -u

    [ -f ".env" ] && source .env

    [ -n "${!var+x}" ] || {
        echo "$var is not set"
        exit 1
    }

    value=$(eval echo "\$$var")

    [ -n "$value" ] || {
        echo "$var has an empty value"
        exit 0
    }

    printf '%s' "$value"

    if command -v pbcopy >/dev/null 2>&1; then
        printf '%s' "$value" | pbcopy
        echo " (copied to paste buffer)"
    elif command -v xclip >/dev/null 2>&1; then
        printf '%s' "$value" | xclip -selection clipboard
        echo " (copied to paste buffer)"
    elif command -v xsel >/dev/null 2>&1; then
        printf '%s' "$value" | xsel --clipboard --input
        echo " (copied to paste buffer)"
    elif command -v wl-copy >/dev/null 2>&1; then
        printf '%s' "$value" | wl-copy
        echo " (copied to paste buffer)"
    elif command -v clip >/dev/null 2>&1; then
        printf '%s' "$value" | clip
        echo " (copied to paste buffer)"
    else
        echo
    fi
)
