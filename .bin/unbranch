#!/bin/bash

default_branch=$(git remote show origin | sed -n '/HEAD branch/s/.*: //p')
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" != "$default_branch" ]; then
    echo "On branch '${current_branch}'. Switch to '${default_branch}' before running this script."
    exit 1
fi

echo "Pruning branches merged into ${default_branch}..."

if ! git branch --merged "${default_branch}" | grep -v "^\* " | grep -v " ${default_branch}$" | grep -q .; then
    echo "No merged branches found."
    exit 0
fi

git branch --merged "${default_branch}" | grep -Ev "(^\*|${default_branch})" | xargs git branch -d
